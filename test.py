import unittest
import proxy

HTTP = b'HTTP/1.1 200 OK\r\nServer: Apache/1.3.41 (Unix) mod_ssl/2.8.31 OpenSSL/0.9.8j\r\nX-Cnection: close\r\nContent-Type: text/html\r\nX-N: S\r\nVary: Accept-Encoding\r\nContent-Encoding: gzip\r\nDate: Tue, 25 Apr 2017 18:19:10 GMT\r\nContent-Length: 4757\r\nConnection: keep-alive\r\n\r\n\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x00\xdd<\xdbr\xdb\xb8\x92\xcfI\xd5\xfe\x03FS5\x966\xa2n\x96|\x8b\xa5\x99\xc4I\xe6\xa4jf\x92:\xf1\xd99S\xa9\xd4\x14D\x82"l\x92`\x00R\xb2\x8e\xe3\xaa\xfd\x87\xfd\xc3\xfd\x92\xed\x06H\x8a\x94\xa8\xab=\xe7a\xfd \x89@\xa3\xbb\xd17t\x03\xa0/\xbf{\xf3\xe1\xea\xfa\x8f\x8fo\x89\x17\x07\xfe\xe8\xf9\xe5w\x96\xf5\x99\xbb\xc4\x8f\xc9\xfb\xb7\xe4\xf4\xcb\x88\xe8\xbfK\xec%\xb6O\x95\x1a\xd6Ba\xdd(\x80\xb08;7_g\xe6\xeb\xb46"\x97\xdf}f\xa1\xc3\xdd/\x96\xb5\xc0VD\xb5\x03\xb6\rh\xcevA\xb3n\xfc$NQ`\xc3\xa8b\xbc\x1ehY\xe5\xc1\x1e\xa3\xce\xe8\xb9&\x18\xb0\x98\x12\xdb\xa3R\xb1xXKb\xd7\x02^MW\xce"`\xd7`^\x1cG\x16\xfb\x9a\xf0\xe9\xb0\xf6O\xeb\x1f\xaf\xac+\x11D4\xe6c\x9f\xd5\x88-\xc2\x98\x85\x80\xe3\xfd\xdb!s&\xaci{R\x04l\xd8\xad\x8dJ\xc45\xea\x98\xc7>\x1b\xfd\xfa\xfe\x9aX\xe4W`\x96\xda^\x02\x0c\xc4\x8a\xbc\x0f\x15t&1#\xc2%\xd7\xcc\xf6B\xe1\x8b\xc9\xfc\xb2m\x86\x14\x98\x0e)`\xaf\xdd\xb2\xf9LHG\x15\x18\xd8\ta\x93\x00\xf5\x1ai\xafbt\x98\xb2%\x8fb.\xc2\x02\xd2k\x8f\x91\x80+\x05\xad\x88\x08Y\xe7\x8a\xc4\x82PgJC\x9b\x91\xdbP\xcc|\x9c8\xa1\xa1C\x98\x93\xd8\x14h\xaa8q`\xbc"<$\xca\xe6\x0c \x9b$\xce\xb9\xd0\xb0"\xf6\x98$T2\xaa\x10\xb5\xb2=\xe1\x83><\x1e\x91\xd8\xa31\x99q\xdf\'c\xa6b\xa2\x98\x9c2hd\xc0*\xf2\xa7\x87\xe3#\x88\xc0w\x90\x06>\xf4\xba\x00j\x03\xd5D\xce[\x95S\x94b,\xe2\xa2\xc8x\xe8\xb0\xbb\xa6+|_\xcc\x9a\xa1\x10N\x04\x9fs\x87\xcb\xca\xe1\x14\xc1,\xc5\xa8\xb4\xbd\x02\x929S\x95\xe0>\r\'\t\x9d\x14m\x84\x85\xd5\xa2\xe7*\x96|\x9c,\xc9~\xe2\x8b1\xf5+GL9\x9bEB\xc6\x05\xe8\x19wbo\xe8\xb0)\xb7\x99\xa5\x1f\x9a \x19\x1es\xea[\xca\xa6>\x98d\x93\x04\xf4\x8e\x07I\xb0h\x00k\x91\xfa\x89\x825\x0f;\xe0\x03\xcfV\x8d\xfe\xa3\xa4\x93\x80\x16h\x81\x8b\xd9`jl\x89\xb7\xe2\x98\xb7w\x11\x97\xac(l\xab\xbb\x01\\\xa3\xb3\x10V\n\xbfLI\xc5B\x1aJf\xac\xcf\xc3["\x99?\xac)\x0fD`\'1\xe16\n\xce\x93\xcc\x1d\xd6\xda.\xf7\x99j\x833\xb0X\xb5y\x00\x1aPm\x97N\x11\xa6\x05\x1f\x05L\xe0\xe9\xe4z\xc6\xe3\x18\xec\xd0\xa6\xd2!\xe8\xa8\xe9\xfc#)"&\xe3\xf9\xb0\x16\x1b\x88\x0b\xc5cv\xc1\x9d\x02s\xddA\xff\xa4\xd3\xe9\x9f\x99y=+*(\x1b\x84h\x0b#T\x12\x04T\xcek\xab\x1a-R)\x0c\xf8)\xe0\xf1\x06h\x1d\x1d\x96\xdcu\xa78@\xea\xe0\xca\r\xc0\x0c\xf3E1|\x88XH~\x964\xf2\xaa\x85 &\x17Z\x94\x05Z\xa8\xbe\x8bv{\xc6\xc6-`\xb2\x05\xae\x0f\xd2\x9e\xb4'

class TestCase(unittest.TestCase):

    def setUp(self):
        pass
        
    def tearDown(self):
        pass
        
    def testParseUrlDefaultPort(self):
        host, port, uri, protocol = proxy.parse_url(b'http://hello.world.com/uri/path/file')
       
        assert protocol == b'http'
        assert host == b'hello.world.com'
        assert port == 80
        assert uri == b'/uri/path/file'
   
   
    def testParseUrlPortDefined(self):
        host, port, uri, protocol = proxy.parse_url(b'https://thing.com:8888/uripath')
        
        assert protocol == b'https'
        assert host == b'thing.com'
        assert port == 8888
        assert uri == b'/uripath'
        
        
    def testParseUrlWOhttpPrefix(self):
        host, port, uri, protocol = proxy.parse_url(b'www.thing.com/uripath')
        
        assert protocol == None
        assert host == b'www.thing.com'
        assert port == 80
        assert uri == b'/uripath'
        
    def testParseUrlNoUri(self):
        host, port, uri, protocol = proxy.parse_url(b'www.thing.com')
        
        assert protocol == None
        assert host == b'www.thing.com'
        assert port == 80
        assert uri == b''

    def testGetHeaders(self):
        headers = proxy.get_http_headers(HTTP)
        self.assertEquals(headers[b'X-Cnection'], b'close\r')

    def testGetHeaderLength(self):
        head_len = proxy.get_header_length(b'1234567890\r\n\r\nbody: [pakjwdjawdapoihawoidha')
        self.assertEquals(head_len, 10)
        
if __name__ == "__main__":
    unittest.main()